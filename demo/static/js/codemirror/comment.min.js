!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function f(a){var b=a.search(c);return-1==b?0:b}function g(a,b,c){return/\bstring\b/.test(a.getTokenTypeAt(d(b.line,0)))&&!/^[\'\"\`]/.test(c)}function h(a,b){var c=a.getMode();return c.useInnerComments!==!1&&c.innerMode?a.getModeAt(b):c}var b={},c=/[^\s\u00a0]/,d=a.Pos,e=a.cmpPos;a.commands.toggleComment=function(a){a.toggleComment()},a.defineExtension("toggleComment",function(a){var c,e,f,g,h,i,j;for(a||(a=b),c=this,e=1/0,f=this.listSelections(),g=null,h=f.length-1;h>=0;h--)i=f[h].from(),j=f[h].to(),i.line>=e||(j.line>=e&&(j=d(e,0)),e=i.line,null==g?c.uncomment(i,j,a)?g="un":(c.lineComment(i,j,a),g="line"):"un"==g?c.uncomment(i,j,a):c.lineComment(i,j,a))}),a.defineExtension("lineComment",function(a,e,i){var j,k,l,m,n,o,p;if(i||(i=b),j=this,k=h(j,a),l=j.getLine(a.line),null!=l&&!g(j,a,l)){if(m=i.lineComment||k.lineComment,!m)return(i.blockCommentStart||k.blockCommentStart)&&(i.fullLines=!0,j.blockComment(a,e,i)),void 0;n=Math.min(0!=e.ch||e.line==a.line?e.line+1:e.line,j.lastLine()+1),o=null==i.padding?" ":i.padding,p=i.commentBlankLines||a.line==e.line,j.operation(function(){var b,e,g,h,k;if(i.indent){for(b=null,e=a.line;n>e;++e)g=j.getLine(e),h=g.slice(0,f(g)),(null==b||b.length>h.length)&&(b=h);for(e=a.line;n>e;++e)g=j.getLine(e),k=b.length,(p||c.test(g))&&(g.slice(0,k)!=b&&(k=f(g)),j.replaceRange(b+m+o,d(e,0),d(e,k)))}else for(e=a.line;n>e;++e)(p||c.test(j.getLine(e)))&&j.replaceRange(m+o,d(e,0))})}}),a.defineExtension("blockComment",function(a,f,g){var i,j,k,l,m,n;return g||(g=b),i=this,j=h(i,a),k=g.blockCommentStart||j.blockCommentStart,l=g.blockCommentEnd||j.blockCommentEnd,k&&l?(/\bcomment\b/.test(i.getTokenTypeAt(d(a.line,0)))||(m=Math.min(f.line,i.lastLine()),m!=a.line&&0==f.ch&&c.test(i.getLine(m))&&--m,n=null==g.padding?" ":g.padding,a.line>m||i.operation(function(){var b,h,o,p,q;if(0!=g.fullLines){if(b=c.test(i.getLine(m)),i.replaceRange(n+l,d(m)),i.replaceRange(k+n,d(a.line,0)),h=g.blockCommentLead||j.blockCommentLead,null!=h)for(o=a.line+1;m>=o;++o)(o!=m||b)&&i.replaceRange(h+n,d(o,0))}else p=0==e(i.getCursor("to"),f),q=!i.somethingSelected(),i.replaceRange(l,f),p&&i.setSelection(q?f:i.getCursor("from"),f),i.replaceRange(k,a)})),void 0):((g.lineComment||j.lineComment)&&0!=g.fullLines&&i.lineComment(a,f,g),void 0)}),a.defineExtension("uncomment",function(a,e,f){var g,i,j,k,l,m,o,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;f||(f=b),g=this,i=h(g,a),j=Math.min(0!=e.ch||e.line==a.line?e.line:e.line-1,g.lastLine()),k=Math.min(a.line,j),l=f.lineComment||i.lineComment,m=[],n=null==f.padding?" ":f.padding;a:if(l){for(p=k;j>=p;++p){if(q=g.getLine(p),r=q.indexOf(l),r>-1&&!/comment/.test(g.getTokenTypeAt(d(p,r+1)))&&(r=-1),-1==r&&c.test(q))break a;if(r>-1&&c.test(q.slice(0,r)))break a;m.push(q)}if(g.operation(function(){var a,b,c,e;for(a=k;j>=a;++a)b=m[a-k],c=b.indexOf(l),e=c+l.length,0>c||(b.slice(e,e+n.length)==n&&(e+=n.length),o=!0,g.replaceRange("",d(a,c),d(a,e)))}),o)return!0}return s=f.blockCommentStart||i.blockCommentStart,t=f.blockCommentEnd||i.blockCommentEnd,s&&t?(u=f.blockCommentLead||i.blockCommentLead,v=g.getLine(k),w=v.indexOf(s),-1==w?!1:(x=j==k?v:g.getLine(j),y=x.indexOf(t,j==k?w+s.length:0),z=d(k,w+1),A=d(j,y+1),-1==y||!/comment/.test(g.getTokenTypeAt(z))||!/comment/.test(g.getTokenTypeAt(A))||g.getRange(z,A,"\n").indexOf(t)>-1?!1:(B=v.lastIndexOf(s,a.ch),C=-1==B?-1:v.slice(0,a.ch).indexOf(t,B+s.length),-1!=B&&-1!=C&&C+t.length!=a.ch?!1:(C=x.indexOf(t,e.ch),D=x.slice(e.ch).lastIndexOf(s,C-e.ch),B=-1==C||-1==D?-1:e.ch+D,-1!=C&&-1!=B&&B!=e.ch?!1:(g.operation(function(){var a,b,e,f,h;if(g.replaceRange("",d(j,y-(n&&x.slice(y-n.length,y)==n?n.length:0)),d(j,y+t.length)),a=w+s.length,n&&v.slice(a,a+n.length)==n&&(a+=n.length),g.replaceRange("",d(k,w),d(k,a)),u)for(b=k+1;j>=b;++b)e=g.getLine(b),f=e.indexOf(u),-1==f||c.test(e.slice(0,f))||(h=f+u.length,n&&e.slice(h,h+n.length)==n&&(h+=n.length),g.replaceRange("",d(b,f),d(b,h)))}),!0))))):!1})});