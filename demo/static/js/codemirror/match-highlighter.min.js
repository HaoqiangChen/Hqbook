!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],a):a(CodeMirror)}(function(a){"use strict";function c(a){this.options={};for(var c in b)this.options[c]=(a&&a.hasOwnProperty(c)?a:b)[c];this.overlay=this.timeout=null,this.matchesonscroll=null,this.active=!1}function d(a){var b=a.state.matchHighlighter;(b.active||a.hasFocus())&&f(a,b)}function e(a){var b=a.state.matchHighlighter;b.active||(b.active=!0,f(a,b))}function f(a,b){clearTimeout(b.timeout),b.timeout=setTimeout(function(){i(a)},b.options.delay)}function g(a,b,c,d){var f,e=a.state.matchHighlighter;a.addOverlay(e.overlay=l(b,c,d)),e.options.annotateScrollbar&&a.showMatchesOnScrollbar&&(f=c?new RegExp((/\w/.test(b.charAt(0))?"\\b":"")+b.replace(/[\\\[.+*?(){|^$]/g,"\\$&")+(/\w/.test(b.charAt(b.length-1))?"\\b":"")):b,e.matchesonscroll=a.showMatchesOnScrollbar(f,!1,{className:"CodeMirror-selection-highlight-scrollbar"}))}function h(a){var b=a.state.matchHighlighter;b.overlay&&(a.removeOverlay(b.overlay),b.overlay=null,b.matchesonscroll&&(b.matchesonscroll.clear(),b.matchesonscroll=null))}function i(a){a.operation(function(){var c,d,e,f,i,k,l,m,b=a.state.matchHighlighter;if(h(a),!a.somethingSelected()&&b.options.showToken){for(c=b.options.showToken===!0?/[\w$]/:b.options.showToken,d=a.getCursor(),e=a.getLine(d.line),f=d.ch,i=f;f&&c.test(e.charAt(f-1));)--f;for(;i<e.length&&c.test(e.charAt(i));)++i;return i>f&&g(a,e.slice(f,i),c,b.options.style),void 0}k=a.getCursor("from"),l=a.getCursor("to"),k.line==l.line&&(!b.options.wordsOnly||j(a,k,l))&&(m=a.getRange(k,l),b.options.trim&&(m=m.replace(/^\s+|\s+$/g,"")),m.length>=b.options.minChars&&g(a,m,!1,b.options.style))})}function j(a,b,c){var e,f,d=a.getRange(b,c);return null!==d.match(/^\w+$/)?b.ch>0&&(e={line:b.line,ch:b.ch-1},f=a.getRange(e,b),null===f.match(/\W/))?!1:c.ch<a.getLine(b.line).length&&(e={line:c.line,ch:c.ch+1},f=a.getRange(c,e),null===f.match(/\W/))?!1:!0:!1}function k(a,b){return!(a.start&&b.test(a.string.charAt(a.start-1))||a.pos!=a.string.length&&b.test(a.string.charAt(a.pos)))}function l(a,b,c){return{token:function(d){return!d.match(a)||b&&!k(d,b)?(d.next(),d.skipTo(a.charAt(0))||d.skipToEnd(),void 0):c}}}var b={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};a.defineOption("highlightSelectionMatches",!1,function(b,f,g){if(g&&g!=a.Init&&(h(b),clearTimeout(b.state.matchHighlighter.timeout),b.state.matchHighlighter=null,b.off("cursorActivity",d),b.off("focus",e)),f){var j=b.state.matchHighlighter=new c(f);b.hasFocus()?(j.active=!0,i(b)):b.on("focus",e),b.on("cursorActivity",d)}})});