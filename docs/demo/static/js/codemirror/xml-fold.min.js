!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function c(a,b){return a.line-b.line||a.ch-b.ch}function g(a,b,c,d){this.line=b,this.ch=c,this.cm=a,this.text=a.getLine(b),this.min=d?Math.max(d.from,a.firstLine()):a.firstLine(),this.max=d?Math.min(d.to-1,a.lastLine()):a.lastLine()}function h(a,c){var d=a.cm.getTokenTypeAt(b(a.line,c));return d&&/\btag\b/.test(d)}function i(a){return a.line>=a.max?void 0:(a.ch=0,a.text=a.cm.getLine(++a.line),!0)}function j(a){return a.line<=a.min?void 0:(a.text=a.cm.getLine(--a.line),a.ch=a.text.length,!0)}function k(a){for(var b,c,d;;){if(b=a.text.indexOf(">",a.ch),-1==b){if(i(a))continue;return}if(h(a,b+1))return c=a.text.lastIndexOf("/",b),d=c>-1&&!/\S/.test(a.text.slice(c+1,b)),a.ch=b+1,d?"selfClose":"regular";a.ch=b+1}}function l(a){for(var b,c;;){if(b=a.ch?a.text.lastIndexOf("<",a.ch-1):-1,-1==b){if(j(a))continue;return}if(h(a,b+1)){if(f.lastIndex=b,a.ch=b,c=f.exec(a.text),c&&c.index==b)return c}else a.ch=b}}function m(a){for(;;){f.lastIndex=a.ch;var b=f.exec(a.text);if(!b){if(i(a))continue;return}{if(h(a,b.index+1))return a.ch=b.index+b[0].length,b;a.ch=b.index+1}}}function n(a){for(var b,c,d;;){if(b=a.ch?a.text.lastIndexOf(">",a.ch-1):-1,-1==b){if(j(a))continue;return}if(h(a,b+1))return c=a.text.lastIndexOf("/",b),d=c>-1&&!/\S/.test(a.text.slice(c+1,b)),a.ch=b+1,d?"selfClose":"regular";a.ch=b}}function o(a,c){for(var f,e,g,h,i,d=[];;){if(e=m(a),g=a.line,h=a.ch-(e?e[0].length:0),!e||!(f=k(a)))return;if("selfClose"!=f)if(e[1]){for(i=d.length-1;i>=0;--i)if(d[i]==e[2]){d.length=i;break}if(0>i&&(!c||c==e[2]))return{tag:e[2],from:b(g,h),to:b(a.line,a.ch)}}else d.push(e[2])}}function p(a,c){for(var e,f,g,h,i,d=[];;){if(e=n(a),!e)return;if("selfClose"!=e){if(f=a.line,g=a.ch,h=l(a),!h)return;if(h[1])d.push(h[2]);else{for(i=d.length-1;i>=0;--i)if(d[i]==h[2]){d.length=i;break}if(0>i&&(!c||c==h[2]))return{tag:h[2],from:b(a.line,a.ch),to:b(f,g)}}}else l(a)}}var b=a.Pos,d="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=d+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",f=new RegExp("<(/?)(["+d+"]["+e+"]*)","g");a.registerHelper("fold","xml",function(a,d){for(var f,h,i,j,e=new g(a,d.line,0);;){if(f=m(e),!f||e.line!=d.line)return;if(h=k(e),!h)return;if(!f[1]&&"selfClose"!=h)return i=b(e.line,e.ch),j=o(e,f[2]),j&&c(j.from,i)>0?{from:i,to:j.from}:null}}),a.findMatchingTag=function(a,d,e){var h,i,j,m,f=new g(a,d.line,d.ch,e);if((-1!=f.text.indexOf(">")||-1!=f.text.indexOf("<"))&&(h=k(f),i=h&&b(f.line,f.ch),j=h&&l(f),h&&j&&!(c(f,d)>0)))return m={from:b(f.line,f.ch),to:i,tag:j[2]},"selfClose"==h?{open:m,close:null,at:"open"}:j[1]?{open:p(f,j[2]),close:m,at:"close"}:(f=new g(a,i.line,i.ch,e),{open:m,close:o(f,j[2]),at:"open"})},a.findEnclosingTag=function(a,b,c,d){for(var f,h,i,e=new g(a,b.line,b.ch,c);f=p(e,d),f;)if(h=new g(a,b.line,b.ch,c),i=o(h,f.tag))return{open:f,close:i}},a.scanForClosingTag=function(a,b,c,d){var e=new g(a,b.line,b.ch,d?{from:0,to:d}:null);return o(e,c)}});