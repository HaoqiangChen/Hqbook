!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],a):a(CodeMirror)}(function(a){"use strict";function c(a){this.options=a,this.from=this.to=0}function d(a){return a===!0&&(a={}),null==a.gutter&&(a.gutter="CodeMirror-foldgutter"),null==a.indicatorOpen&&(a.indicatorOpen="CodeMirror-foldgutter-open"),null==a.indicatorFolded&&(a.indicatorFolded="CodeMirror-foldgutter-folded"),a}function e(a,c){var e,f,d=a.findMarks(b(c,0),b(c+1,0));for(e=0;e<d.length;++e)if(d[e].__isFold&&(f=d[e].find(-1),f&&f.line===c))return d[e]}function f(a){if("string"==typeof a){var b=document.createElement("div");return b.className=a+" CodeMirror-guttermarker-subtle",b}return a.cloneNode(!0)}function g(a,c,d){var g=a.state.foldGutter.options,i=c-1,j=a.foldOption(g,"minFoldSize"),k=a.foldOption(g,"rangeFinder"),l="string"==typeof g.indicatorFolded&&h(g.indicatorFolded),m="string"==typeof g.indicatorOpen&&h(g.indicatorOpen);a.eachLine(c,d,function(c){var d,h,n,o;if(++i,d=null,h=c.gutterMarkers,h&&(h=h[g.gutter]),e(a,i)){if(l&&h&&l.test(h.className))return;d=f(g.indicatorFolded)}else if(n=b(i,0),o=k&&k(a,n),o&&o.to.line-o.from.line>=j){if(m&&h&&m.test(h.className))return;d=f(g.indicatorOpen)}(d||h)&&a.setGutterMarker(c,g.gutter,d)})}function h(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function i(a){var b=a.getViewport(),c=a.state.foldGutter;c&&(a.operation(function(){g(a,b.from,b.to)}),c.from=b.from,c.to=b.to)}function j(a,c,d){var g,h,f=a.state.foldGutter;f&&(g=f.options,d==g.gutter&&(h=e(a,c),h?h.clear():a.foldCode(b(c,0),g)))}function k(a){var c,b=a.state.foldGutter;b&&(c=b.options,b.from=b.to=0,clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout(function(){i(a)},c.foldOnChangeTimeSpan||600))}function l(a){var c,b=a.state.foldGutter;b&&(c=b.options,clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout(function(){var c=a.getViewport();b.from==b.to||c.from-b.to>20||b.from-c.to>20?i(a):a.operation(function(){c.from<b.from&&(g(a,c.from,b.from),b.from=c.from),c.to>b.to&&(g(a,b.to,c.to),b.to=c.to)})},c.updateViewportTimeSpan||400))}function m(a,b){var d,c=a.state.foldGutter;c&&(d=b.line,d>=c.from&&d<c.to&&g(a,d,d+1))}a.defineOption("foldGutter",!1,function(b,e,f){f&&f!=a.Init&&(b.clearGutter(b.state.foldGutter.options.gutter),b.state.foldGutter=null,b.off("gutterClick",j),b.off("changes",k),b.off("viewportChange",l),b.off("fold",m),b.off("unfold",m),b.off("swapDoc",k)),e&&(b.state.foldGutter=new c(d(e)),i(b),b.on("gutterClick",j),b.on("changes",k),b.on("viewportChange",l),b.on("fold",m),b.on("unfold",m),b.on("swapDoc",k))});var b=a.Pos});