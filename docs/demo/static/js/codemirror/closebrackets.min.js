!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function d(a,c){return"pairs"==c&&"string"==typeof a?a:"object"==typeof a&&null!=a[c]?a[c]:b[c]}function f(a){var b,c,d;for(b=0;b<a.length;b++)c=a.charAt(b),d="'"+c+"'",e[d]||(e[d]=g(c))}function g(a){return function(b){return l(b,a)}}function h(a){var c,b=a.state.closeBrackets;return!b||b.override?b:(c=a.getModeAt(a.getCursor()),c.closeBrackets||b)}function i(b){var f,g,i,j,k,e=h(b);if(!e||b.getOption("disableInput"))return a.Pass;for(f=d(e,"pairs"),g=b.listSelections(),i=0;i<g.length;i++){if(!g[i].empty())return a.Pass;if(j=m(b,g[i].head),!j||0!=f.indexOf(j)%2)return a.Pass}for(i=g.length-1;i>=0;i--)k=g[i].head,b.replaceRange("",c(k.line,k.ch-1),c(k.line,k.ch+1),"+delete")}function j(b){var f,g,i,c=h(b),e=c&&d(c,"explode");if(!e||b.getOption("disableInput"))return a.Pass;for(f=b.listSelections(),g=0;g<f.length;g++){if(!f[g].empty())return a.Pass;if(i=m(b,f[g].head),!i||0!=e.indexOf(i)%2)return a.Pass}b.operation(function(){var c,d,a=b.lineSeparator()||"\n";for(b.replaceSelection(a+a,null),b.execCommand("goCharLeft"),f=b.listSelections(),c=0;c<f.length;c++)d=f[c].head.line,b.indentLine(d,null,!0),b.indentLine(d+1,null,!0)})}function k(b){var d=a.cmpPos(b.anchor,b.head)>0;return{anchor:new c(b.anchor.line,b.anchor.ch+(d?-1:1)),head:new c(b.head.line,b.head.ch+(d?1:-1))}}function l(b,e){var g,i,j,l,m,o,p,q,r,u,s,t,v,w,x,y,f=h(b);if(!f||b.getOption("disableInput"))return a.Pass;if(g=d(f,"pairs"),i=g.indexOf(e),-1==i)return a.Pass;for(j=d(f,"closeBefore"),l=d(f,"triples"),m=g.charAt(i+1)==e,o=b.listSelections(),p=0==i%2,r=0;r<o.length;r++){if(s=o[r],t=s.head,v=b.getRange(t,c(t.line,t.ch+1)),p&&!s.empty())u="surround";else if(!m&&p||v!=e)if(m&&t.ch>1&&l.indexOf(e)>=0&&b.getRange(c(t.line,t.ch-2),t)==e+e){if(t.ch>2&&/\bstring/.test(b.getTokenTypeAt(c(t.line,t.ch-2))))return a.Pass;u="addFour"}else if(m){if(w=0==t.ch?" ":b.getRange(c(t.line,t.ch-1),t),a.isWordChar(v)||w==e||a.isWordChar(w))return a.Pass;u="both"}else{if(!p||!(0===v.length||/\s/.test(v)||j.indexOf(v)>-1))return a.Pass;u="both"}else u=m&&n(b,t)?"both":l.indexOf(e)>=0&&b.getRange(t,c(t.line,t.ch+3))==e+e+e?"skipThree":"skip";if(q){if(q!=u)return a.Pass}else q=u}x=i%2?g.charAt(i-1):e,y=i%2?e:g.charAt(i+1),b.operation(function(){var a,c;if("skip"==q)b.execCommand("goCharRight");else if("skipThree"==q)for(a=0;3>a;a++)b.execCommand("goCharRight");else if("surround"==q){for(c=b.getSelections(),a=0;a<c.length;a++)c[a]=x+c[a]+y;for(b.replaceSelections(c,"around"),c=b.listSelections().slice(),a=0;a<c.length;a++)c[a]=k(c[a]);b.setSelections(c)}else"both"==q?(b.replaceSelection(x+y,null),b.triggerElectric(x+y),b.execCommand("goCharLeft")):"addFour"==q&&(b.replaceSelection(x+x+x+x,"before"),b.execCommand("goCharRight"))})}function m(a,b){var d=a.getRange(c(b.line,b.ch-1),c(b.line,b.ch+1));return 2==d.length?d:null}function n(a,b){var d=a.getTokenAt(c(b.line,b.ch+1));return/\bstring/.test(d.type)&&d.start==b.ch&&(0==b.ch||!/\bstring/.test(a.getTokenTypeAt(b)))}var e,b={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},c=a.Pos;a.defineOption("autoCloseBrackets",!1,function(b,c,g){g&&g!=a.Init&&(b.removeKeyMap(e),b.state.closeBrackets=null),c&&(f(d(c,"pairs")),b.state.closeBrackets=c,b.addKeyMap(e))}),e={Backspace:i,Enter:j},f(b.pairs+"`")});